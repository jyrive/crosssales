---
description: Instructions for GitHub Copilot when working on the Insurance Cross-Sales Solution project
applyTo: '**'
---

# GitHub Copilot Instructions - Insurance Cross-Sales Solution

## Project Context

This project develops a digital cross-sales solution for a Nordic insurance company serving B2B customers. The solution focuses on intelligent insurance product recommendations and next-best-action strategies for SMEs with turnover under €50M EUR.

### Key Business Context
- **Industry**: Insurance (B2B focus)
- **Market**: Nordic countries (Denmark, Finland, Iceland, Norway, Sweden)
- **Customer Segment**: Small and Medium Enterprises (SMEs)
- **Distribution**: Direct-to-customer (no brokers)
- **Core Functionality**: Cross-sales recommendations and next-best-action engine

## Code Generation Guidelines

### General Principles
- **Data Privacy First**: Always implement GDPR-compliant data handling
- **Nordic Compliance**: Consider local insurance regulations across Nordic markets
- **Scalability**: Design for SME customer base growth
- **Performance**: Optimize for real-time recommendation engines
- **Security**: Implement robust security for financial/insurance data
- **Multilingual**: Support for Nordic languages when applicable

### Domain-Specific Terminology
Use these terms consistently throughout the codebase:

**Business Terms:**
- `Customer` - B2B insurance policyholder company
- `Policy` - Insurance contract
- `Premium` - Insurance cost/payment
- `Coverage` - Insurance protection scope
- `Cross-sell` - Selling additional insurance products
- `Next-best-action` - Recommended action for customer engagement
- `SME` - Small and Medium Enterprise
- `Turnover` - Company revenue/annual sales

**Technical Terms:**
- `RecommendationEngine` - Core ML/AI system for product suggestions
- `CustomerSegmentation` - Classification of customers by various criteria
- `RiskProfile` - Customer's insurance risk assessment
- `ProductCatalog` - Available insurance products
- `TriggerEvent` - Business event that prompts cross-sell opportunity

### Data Modeling Standards

#### Customer Data
```typescript
interface Customer {
  customerId: string;
  companyName: string;
  country: 'DK' | 'FI' | 'IS' | 'NO' | 'SE';
  turnover: number; // EUR
  employeeCount: number;
  industry: IndustryType;
  riskProfile: RiskProfile;
  currentPolicies: Policy[];
  // Always include GDPR consent tracking
  gdprConsent: GDPRConsent;
}
```

#### Recommendation Structure
```typescript
interface Recommendation {
  recommendationId: string;
  customerId: string;
  productType: InsuranceProductType;
  priority: 'HIGH' | 'MEDIUM' | 'LOW';
  confidenceScore: number; // 0-1
  reasoning: string[];
  expiresAt: Date;
  nextBestAction: NextBestAction;
}
```

### Naming Conventions

**Files and Directories:**
- Use kebab-case for file names: `customer-segmentation.service.ts`
- Use PascalCase for class files: `RecommendationEngine.ts`
- Group by domain: `/customers/`, `/recommendations/`, `/policies/`, `/analytics/`

**Classes and Interfaces:**
- Use PascalCase: `class CustomerSegmentationService`
- Interface names with 'I' prefix: `interface IRecommendationEngine`
- Enum names descriptive: `enum InsuranceProductType`

**Variables and Functions:**
- Use camelCase: `calculateRiskScore()`, `customerTurnover`
- Business logic functions descriptive: `generateCrossSellOpportunities()`
- Boolean variables with 'is/has/can' prefix: `isEligibleForCrossSell`

### Security and Privacy Requirements

#### Data Protection
- **Never log sensitive customer data** (financial info, personal details)
- **Encrypt all customer data** at rest and in transit
- **Implement data retention policies** per GDPR requirements
- **Add audit trails** for all customer data access

#### Code Examples for Data Handling
```typescript
// Good: GDPR-compliant data access
async function getCustomerRecommendations(customerId: string, userConsent: boolean) {
  if (!userConsent) {
    throw new Error('Customer consent required for recommendations');
  }
  
  const auditLog = {
    action: 'RECOMMENDATION_ACCESS',
    customerId,
    timestamp: new Date(),
    userId: getCurrentUserId()
  };
  await logDataAccess(auditLog);
  
  return recommendationEngine.generate(customerId);
}

// Bad: Direct access without consent validation
async function getRecommendations(customerId: string) {
  return database.getCustomerData(customerId); // No consent check!
}
```

### Insurance-Specific Logic Patterns

#### Risk Assessment
```typescript
// Always consider multiple risk factors
function calculateRiskProfile(customer: Customer): RiskProfile {
  const factors = [
    assessIndustryRisk(customer.industry),
    assessSizeRisk(customer.employeeCount, customer.turnover),
    assessGeographicRisk(customer.country),
    assessClaimsHistory(customer.customerId)
  ];
  
  return aggregateRiskFactors(factors);
}
```

#### Recommendation Logic
```typescript
// Implement explainable recommendations
interface RecommendationReasoning {
  factor: string;
  impact: 'POSITIVE' | 'NEGATIVE' | 'NEUTRAL';
  explanation: string;
  weight: number;
}

// Always provide reasoning for compliance and transparency
function generateRecommendation(customer: Customer): Recommendation {
  const reasoning: RecommendationReasoning[] = [];
  // Add clear reasoning for each recommendation
}
```

### API Design Standards

#### Endpoint Naming
- RESTful patterns: `/api/v1/customers/{id}/recommendations`
- Use plural nouns: `/customers`, `/policies`, `/recommendations`
- Include version: `/api/v1/`

#### Response Structure
```typescript
interface ApiResponse<T> {
  success: boolean;
  data?: T;
  error?: {
    code: string;
    message: string;
    details?: any;
  };
  metadata?: {
    timestamp: string;
    requestId: string;
    version: string;
  };
}
```

### Testing Standards

#### Unit Tests
- Test business logic thoroughly, especially financial calculations
- Mock external services (regulatory APIs, data providers)
- Test edge cases for Nordic market differences

#### Integration Tests
- Test GDPR compliance flows
- Validate recommendation accuracy
- Test multi-country scenarios

#### Example Test Structure
```typescript
describe('RecommendationEngine', () => {
  describe('for Nordic SME customers', () => {
    it('should recommend cyber insurance for tech companies', () => {
      // Test implementation
    });
    
    it('should respect GDPR consent limitations', () => {
      // Test GDPR compliance
    });
  });
});
```

### Performance Considerations

#### Recommendation Engine
- Cache customer segments and risk profiles
- Implement async processing for complex calculations
- Use batch processing for large customer sets
- Monitor recommendation latency (<500ms target)

#### Database Queries
- Index customer industry and turnover fields
- Optimize for cross-sell opportunity queries
- Implement read replicas for analytics workloads

### Documentation Standards

#### Code Comments
```typescript
/**
 * Calculates cross-sell opportunities for Nordic SME customers
 * 
 * @param customer - Target customer for recommendations
 * @param constraints - Business constraints (budget, timeline, etc.)
 * @returns Array of prioritized recommendations with reasoning
 * 
 * @compliance GDPR - Requires valid customer consent
 * @businessRule Only recommend to customers with turnover < €50M
 */
```

#### API Documentation
- Include business context in endpoint descriptions
- Document Nordic market-specific parameters
- Provide compliance requirements for each endpoint

### Error Handling

#### Business Errors
```typescript
export enum CrossSellErrorCodes {
  INSUFFICIENT_DATA = 'CS001',
  GDPR_CONSENT_REQUIRED = 'CS002',
  CUSTOMER_NOT_ELIGIBLE = 'CS003',
  RECOMMENDATION_EXPIRED = 'CS004'
}
```

#### Error Messages
- Make errors business-user friendly
- Include next steps for resolution
- Log technical details separately

### Development Workflow

#### Branch Naming
- Feature branches: `feature/customer-segmentation`
- Bug fixes: `fix/recommendation-accuracy`
- Compliance updates: `compliance/gdpr-enhancement`

#### Commit Messages
- Use conventional commits: `feat(recommendations): add industry-specific logic`
- Include business impact: `improve cross-sell conversion by 15%`

### Monitoring and Analytics

#### Key Metrics to Track
- Recommendation accuracy and conversion rates
- Customer engagement with cross-sell offers
- GDPR compliance metrics
- System performance and latency

#### Logging Standards
```typescript
// Structure logs for business analytics
const businessEvent = {
  eventType: 'RECOMMENDATION_GENERATED',
  customerId: customer.id,
  productType: recommendation.productType,
  confidence: recommendation.confidenceScore,
  country: customer.country,
  industry: customer.industry
};

logger.info('Business Event', businessEvent);
```

---

**Remember**: This is an insurance domain project with strict regulatory requirements. Always prioritize data protection, explainable AI, and compliance with Nordic insurance regulations when generating code or making architectural decisions.